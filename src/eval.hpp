#pragma once

#include "move.hpp"
#include "types.hpp"

namespace Eval {

constexpr int totalPhase = 24;

struct Info {
    Info() = default;
    int getRawEval() const;
    void addPiece(Square square, pieceTypes piece);
    void removePiece(Square square, pieceTypes piece);

    int opScore = 0;
    int egScore = 0;
    int phase = 0;
};

int getPiecePhase(pieceTypes piece);
int getPlacementScoreOp(Square square, pieceTypes currPiece);
int getPlacementScoreEg(Square square, pieceTypes currPiece);

// opening tables

constexpr std::array<int, BOARD_SIZE> tableKingOp = {
-240, -180, 214, 210, 539, 458, -354, 405,
-83, -308, -198, 16, 757, -337, -398, 138,
118, -165, -334, -53, -122, -108, -170, -92,
-191, -38, -158, 59, -0, 14, -8, 9,
96, 8, -172, 137, -33, 13, 26, -27,
-87, -20, 20, -143, -137, -136, 12, 52,
69, -77, 21, -48, -89, -75, 41, 114,
14, 60, 23, -179, 92, -51, 99, 74,
};

constexpr std::array<int, BOARD_SIZE> tableQueenOp = {
1887, 1971, 2004, 1938, 2132, 2164, 2240, 2239,
1981, 1971, 2005, 1955, 1969, 2176, 1992, 2248,
2022, 2005, 2030, 2009, 2157, 2166, 2134, 2108,
2047, 2092, 2002, 2048, 2040, 2081, 2010, 2040,
2034, 2052, 2005, 2035, 2022, 2021, 2028, 2001,
1950, 2052, 2066, 2046, 2022, 2055, 2041, 2065,
2093, 2035, 2075, 2053, 2063, 2047, 2000, 2099,
1965, 2008, 2038, 2055, 2025, 1893, 1820, 2224,
};

constexpr std::array<int, BOARD_SIZE> tableBishopOp = {
549, 446, 372, 387, 354, 243, 461, 161,
488, 449, 472, 557, 453, 496, 576, 544,
466, 499, 523, 536, 533, 653, 632, 551,
462, 476, 484, 541, 532, 567, 490, 467,
508, 448, 462, 541, 519, 493, 461, 504,
469, 446, 463, 476, 486, 478, 490, 479,
475, 484, 508, 470, 472, 418, 532, 632,
575, 390, 461, 406, 582, 443, 984, -7,
};

constexpr std::array<int, BOARD_SIZE> tableKnightOp = {
166, 126, 461, 391, 484, 376, 367, 195,
382, 360, 482, 496, 670, 660, 233, 475,
440, 430, 472, 507, 642, 525, 455, 449,
417, 464, 474, 512, 487, 531, 443, 469,
420, 509, 460, 431, 439, 485, 418, 453,
400, 417, 446, 487, 475, 453, 415, 393,
446, 468, 421, 432, 434, 339, 556, 432,
681, 401, 411, 355, 399, 438, 421, 370,
};

constexpr std::array<int, BOARD_SIZE> tableRookOp = {
589, 710, 848, 769, 802, 874, 658, 766,
692, 735, 686, 824, 781, 905, 820, 893,
701, 818, 671, 747, 821, 738, 764, 780,
647, 643, 670, 754, 674, 718, 643, 655,
689, 662, 660, 708, 676, 630, 717, 665,
716, 679, 687, 701, 671, 652, 742, 652,
599, 626, 712, 594, 692, 701, 579, 535,
658, 659, 670, 672, 668, 674, 680, 634,
};

constexpr std::array<int, BOARD_SIZE> tablePawnOp = {
0, 0, 0, 0, 0, 0, 0, 0,
472, 443, 264, 204, 332, 95, 71, 172,
157, 146, 146, 137, 115, 207, 159, 147,
113, 63, 92, 104, 114, 72, 113, 64,
51, 83, 79, 96, 84, 84, 93, 80,
46, 99, 79, 77, 78, 65, 172, 101,
40, 77, 59, 54, 63, 130, 195, 72,
0, 0, 0, 0, 0, 0, 0, 0,
};

// Endgame tables

constexpr std::array<int, BOARD_SIZE> tableKingEg = {
174, 202, 117, -9, -62, -52, 102, 29,
129, 167, 200, 131, -277, 172, 157, -80,
32, 93, 180, 97, 136, 65, 103, 87,
88, 80, 117, 74, 100, 102, 92, 63,
-3, 33, 74, 52, 91, 74, 71, 68,
19, 44, 31, 99, 100, 109, 74, 43,
-19, 80, 47, 45, 76, 78, 51, 14,
-1, -21, 21, 46, -43, 34, 12, 2,
};

constexpr std::array<int, BOARD_SIZE> tableQueenEg = {
478, 427, 467, 510, 364, 334, 283, 349,
343, 446, 432, 479, 462, 379, 408, 250,
308, 409, 361, 415, 354, 361, 352, 323,
330, 244, 338, 389, 393, 392, 380, 275,
336, 251, 380, 391, 402, 326, 321, 352,
366, 236, 170, 232, 283, 245, 263, 180,
153, 255, 152, 195, 158, 176, 158, 113,
230, 231, 272, 223, 268, 269, 165, 137,
};

constexpr std::array<int, BOARD_SIZE> tableBishopEg = {
213, 242, 243, 276, 295, 358, 269, 269,
204, 280, 263, 244, 274, 255, 210, 279,
261, 287, 265, 263, 215, 272, 271, 247,
246, 291, 258, 229, 262, 215, 232, 252,
178, 264, 262, 271, 233, 259, 268, 215,
190, 214, 303, 282, 293, 240, 181, 192,
181, 227, 196, 232, 249, 306, 191, 124,
277, 229, 192, 191, 191, 199, 72, 299,
};

constexpr std::array<int, BOARD_SIZE> tableKnightEg = {
320, 300, 257, 210, 125, 193, 251, 356,
192, 225, 227, 259, 8, 148, 274, 151,
184, 252, 246, 251, 225, 218, 232, 150,
241, 195, 248, 272, 251, 201, 253, 179,
187, 192, 211, 268, 240, 234, 214, 149,
112, 163, 166, 203, 187, 196, 208, 218,
188, 143, 182, 192, 158, 224, 191, 162,
21, 54, 160, 153, 143, 129, 112, 89,
};

constexpr std::array<int, BOARD_SIZE> tableRookEg = {
482, 401, 389, 404, 382, 377, 444, 371,
438, 414, 466, 388, 418, 354, 401, 359,
430, 387, 435, 405, 378, 388, 400, 391,
433, 439, 438, 395, 431, 437, 425, 412,
409, 429, 406, 378, 379, 410, 370, 410,
337, 336, 368, 373, 384, 368, 323, 349,
312, 323, 341, 407, 350, 370, 355, 403,
373, 385, 394, 404, 396, 396, 395, 333,
};

constexpr std::array<int, BOARD_SIZE> tablePawnEg = {
0, 0, 0, 0, 0, 0, 0, 0,
257, 321, 295, 354, 327, 309, 344, 293,
278, 270, 249, 195, 286, 143, 193, 228,
190, 211, 160, 157, 149, 133, 152, 146,
185, 168, 127, 139, 132, 142, 146, 129,
191, 158, 145, 160, 171, 146, 130, 131,
175, 170, 164, 68, 169, 154, 124, 135,
0, 0, 0, 0, 0, 0, 0, 0,
};

constexpr std::array<std::array<int, BOARD_SIZE>, 6> tablesOp = {tableKingOp, tableQueenOp, tableBishopOp, tableKnightOp, tableRookOp, tablePawnOp};
constexpr std::array<std::array<int, BOARD_SIZE>, 6> tablesEg = {tableKingEg, tableQueenEg, tableBishopEg, tableKnightEg, tableRookEg, tablePawnEg};

} // namespace eval