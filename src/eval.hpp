#pragma once

#include "move.hpp"
#include "types.hpp"

namespace Eval {

constexpr int totalPhase = 24;

struct Info {
    Info() = default;
    int getRawEval() const;
    void addPiece(Square square, pieceTypes piece);
    void removePiece(Square square, pieceTypes piece);

    int opScore = 0;
    int egScore = 0;
    int phase = 0;
};

int getPiecePhase(pieceTypes piece);
int getPlacementScoreOp(Square square, pieceTypes currPiece);
int getPlacementScoreEg(Square square, pieceTypes currPiece);

// opening tables

constexpr std::array<int, BOARD_SIZE> tableKingOp = {
-203, -138, 140, 135, 413, 323, -259, 269,
-69, -226, -148, -5, 520, -247, -287, 86,
69, -127, -243, -47, -97, -87, -130, -74,
-145, -39, -122, 31, -10, -2, -17, -4,
54, -5, -131, 84, -33, -2, 7, -30,
-72, -26, 4, -111, -106, -106, -3, 25,
37, -65, 3, -44, -74, -64, 17, 68,
-1, 31, 5, -136, 53, -47, 58, 40,
};

constexpr std::array<int, BOARD_SIZE> tableQueenOp = {
1364, 1424, 1445, 1401, 1536, 1555, 1602, 1600,
1434, 1427, 1451, 1415, 1425, 1569, 1443, 1619,
1463, 1451, 1468, 1453, 1556, 1560, 1540, 1523,
1480, 1511, 1448, 1480, 1475, 1503, 1455, 1475,
1471, 1483, 1451, 1472, 1462, 1462, 1467, 1448,
1413, 1484, 1493, 1479, 1463, 1486, 1476, 1492,
1513, 1472, 1499, 1484, 1491, 1480, 1447, 1518,
1425, 1453, 1474, 1486, 1465, 1374, 1342, 1623,
};

constexpr std::array<int, BOARD_SIZE> tableBishopOp = {
387, 315, 263, 274, 251, 172, 329, 116,
345, 317, 334, 393, 320, 350, 406, 384,
329, 352, 369, 378, 376, 460, 446, 388,
327, 336, 342, 381, 375, 400, 346, 330,
358, 317, 326, 382, 366, 348, 326, 356,
331, 315, 327, 336, 343, 337, 346, 339,
336, 342, 359, 332, 333, 296, 375, 445,
406, 276, 326, 288, 410, 313, 701, 1,
};

constexpr std::array<int, BOARD_SIZE> tableKnightOp = {
116, 93, 326, 278, 343, 265, 265, 137,
271, 255, 340, 350, 471, 465, 166, 334,
311, 304, 333, 358, 452, 371, 321, 317,
295, 328, 335, 361, 344, 375, 314, 331,
297, 359, 325, 305, 311, 342, 296, 320,
283, 295, 315, 344, 336, 320, 294, 279,
315, 331, 298, 305, 307, 241, 392, 306,
484, 284, 291, 252, 282, 310, 298, 262,
};

constexpr std::array<int, BOARD_SIZE> tableRookOp = {
417, 502, 599, 543, 567, 617, 466, 542,
489, 518, 484, 581, 551, 638, 578, 631,
495, 577, 474, 527, 578, 521, 539, 550,
457, 455, 473, 532, 477, 507, 455, 463,
487, 468, 467, 500, 477, 446, 506, 470,
505, 480, 485, 495, 474, 461, 523, 460,
424, 443, 502, 420, 489, 495, 410, 379,
464, 465, 473, 475, 472, 476, 480, 448,
};

constexpr std::array<int, BOARD_SIZE> tablePawnOp = {
0, 0, 0, 0, 0, 0, 0, 0,
332, 312, 185, 144, 233, 67, 50, 120,
110, 103, 102, 96, 81, 144, 112, 103,
79, 44, 65, 73, 80, 51, 79, 45,
36, 58, 55, 67, 59, 59, 66, 56,
32, 69, 55, 54, 55, 46, 121, 71,
28, 54, 42, 38, 44, 91, 137, 51,
0, 0, 0, 0, 0, 0, 0, 0,
};

// Endgame tables

constexpr std::array<int, BOARD_SIZE> tableKingEg = {
93, 109, 49, -36, -81, -69, 41, -10,
59, 86, 109, 62, -223, 90, 79, -86,
-8, 35, 96, 37, 64, 15, 42, 31,
32, 26, 51, 21, 40, 41, 34, 14,
-32, -7, 22, 6, 33, 21, 19, 18,
-16, 0, -9, 39, 40, 46, 22, 0,
-43, 26, 3, 2, 23, 24, 6, -20,
-30, -45, -15, 2, -60, -6, -22, -29,
};

constexpr std::array<int, BOARD_SIZE> tableQueenEg = {
320, 282, 312, 340, 238, 220, 188, 236,
220, 292, 282, 315, 304, 246, 264, 157,
195, 266, 233, 270, 229, 236, 228, 206,
212, 152, 217, 253, 256, 255, 246, 175,
215, 156, 245, 254, 262, 208, 205, 226,
235, 145, 101, 143, 178, 153, 164, 108,
88, 158, 87, 117, 92, 105, 92, 62,
139, 142, 171, 136, 168, 167, 86, 69,
};

constexpr std::array<int, BOARD_SIZE> tableBishopEg = {
148, 168, 169, 192, 205, 249, 186, 187,
142, 194, 183, 169, 190, 177, 146, 194,
181, 199, 184, 183, 149, 189, 188, 172,
171, 202, 179, 159, 182, 149, 161, 175,
124, 184, 182, 188, 162, 180, 186, 149,
132, 148, 211, 196, 204, 166, 125, 133,
125, 158, 136, 161, 173, 212, 132, 86,
192, 159, 133, 133, 132, 138, 47, 208,
};

constexpr std::array<int, BOARD_SIZE> tableKnightEg = {
224, 208, 179, 145, 86, 134, 173, 248,
133, 156, 157, 180, 5, 102, 190, 105,
128, 175, 171, 174, 156, 151, 161, 104,
167, 135, 172, 189, 174, 140, 175, 124,
129, 133, 147, 186, 166, 162, 149, 103,
77, 113, 115, 141, 130, 136, 144, 151,
131, 99, 126, 133, 110, 155, 133, 113,
13, 37, 111, 106, 98, 89, 77, 61,
};

constexpr std::array<int, BOARD_SIZE> tableRookEg = {
335, 279, 270, 281, 265, 261, 308, 257,
305, 288, 324, 269, 291, 245, 278, 249,
299, 269, 302, 282, 263, 270, 278, 272,
301, 305, 304, 274, 300, 304, 295, 286,
285, 298, 282, 263, 263, 285, 257, 285,
234, 233, 255, 259, 267, 256, 224, 242,
217, 225, 237, 283, 243, 258, 247, 280,
260, 268, 274, 281, 275, 276, 274, 231,
};

constexpr std::array<int, BOARD_SIZE> tablePawnEg = {
0, 0, 0, 0, 0, 0, 0, 0,
178, 223, 205, 246, 227, 215, 239, 204,
193, 188, 173, 136, 199, 100, 134, 159,
133, 147, 112, 109, 104, 93, 105, 102,
129, 117, 89, 97, 92, 99, 101, 90,
133, 110, 101, 111, 119, 101, 90, 91,
122, 119, 114, 47, 117, 107, 86, 94,
0, 0, 0, 0, 0, 0, 0, 0,
};

constexpr std::array<std::array<int, BOARD_SIZE>, 6> tablesOp = {tableKingOp, tableQueenOp, tableBishopOp, tableKnightOp, tableRookOp, tablePawnOp};
constexpr std::array<std::array<int, BOARD_SIZE>, 6> tablesEg = {tableKingEg, tableQueenEg, tableBishopEg, tableKnightEg, tableRookEg, tablePawnEg};

} // namespace eval